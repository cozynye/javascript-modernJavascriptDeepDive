# 전역 변수의 문제점



## 1. 변수의 생명주기

#### 지역 변수의 생명주기

> 생명주기 - 변수는 생물과 유사하게 생성되고 소멸된다.
>
> why? 생명 주기가 없다면 한번 선언된 변수는 프로그램을 종료하지 않는 한 계속 메모리 공간을 점유하기 때문

전역 변수의 생명 주기는 애플리케이션의 생명 주기와 같고,

지역 변수는 함수가 호출되면 생성되고 함수가 종료하면 소멸한다.

-> 지역 변수의 생명 주기는 함수의 생명 주기와 일치

----

함수 내부에서 선언한 지역 변수는 런타임 이전 단계에서 자바스크립트 엔진에 의해 실행되는 전역 변수와 다르게 함수가 호출된 직후 함수 몸체의 코드가 한 줄씩 순차적으로 실행되기 이전에 자바스크립트 엔진에 의해 먼저 실행된다.

----



#### 전역 변수의 생명 주기

var 키워드로 선언한 전역 변수는 전역 객체의 프로퍼티가 된다.

> **전역 객체**(global object) - 코드가 실행되기 이전 단계에서 자바스크립트 엔진에 의해 어떤 객체보다도 먼저 생성되는 특수한 객체
>
> 클라이언트 사이드 환경(브라우저)에서는 window, 서버 사이드 환경(Node.js)에서는 global 객체를 의미
>
> (ex 브라우저 환경에서 var 키워드로 선언한 전역 변수는 웹페이지를 닫을 때까지 유효)
>
> -> 전역 변수의 생명 주기가 전역 객체의 생명 주기와 일치한다는 것



<br>

## 2. 전역 변수의 문제점



#### 긴 생명 주기

전역 변수는 생명주기가 길어 메모리 리소스도 오랜 기간 소비한다.

또한 상태를 변경할 수 있는 시간과 기회가 많아 의도치 않은 재할당이 이뤄진다.



#### 스코프 체인 상에서 종점에 존재

변수를 검색 할 때 전역 변수가 가장 마지막에 검색되므로 **전역 변수의 검색 속도는 가장 느리다**



#### 네임스페이스 오염

자바스크립트 파일이 분리되어 있다해도 하나의 스코프를 공유하므로 동일한 전역 변수나 전역 함수가 존재할 경우 예상치 못한 결과가 일어날 수 있다.



<br>

## 전역 변수의 사용을 억제하는 방법

무분별한 전역 변수 사용은 위험하므로 전역 변수를 사용해야할 이유가 없다면 지역 변수를 사용해야 한다.



#### 즉시 실행 함수

모든 코드를 즉시 실행 함수로 감싸면 모든 변수는 즉시 실행 함수의 지역 변수가 된다.

```js
(function(){
    var x = 10;
}());

console.log(x); // ReferenceError
```



#### 네임스페이스 객체

> 네임스페이스 - 구분이 가능하도록 정해놓은 범위나 영역
>
> -> 다른 공간과 구분하도록 이름 공간을 선언

전역에 네임스페이스 역할을 담당할 객체를 생성하고 전역 변수처럼 사용하고 싶은 변수를 프로퍼티로 추가하는 방법

-> 네임스페이스 객체 자체가 전역 변수에 할당되므로 유용하지는 않다.

```js
var NAMESPACE = {}; // 전역 네임스페이스 객체

NAMESPACE.name = 'Hong';

NAMESPACE.name // Hong

NAMESPACE.info={
    address : 'Seoul',
    phone : '010'
}
NAMESPACE.info.address // Seoul
```



#### 모듈 패턴

모듈 패턴은 클래스를 모방해서 관련이 있는 변수와 함수를 모아 즉시 실행함수로 감싸 하나의 모듈을 만든다.

전역변수의 억제와 캡슐화 까지 구현 가능하다.

> 캡슐화 - 객체의 상태를 나타내는 프로퍼티와 프로퍼티를 참조하고 조작할 수 있는 동작인 메서드를 하나로 묶는 것

```js
var Counter = ( function(){
    var num = 0; // private 변수

    // 외부로 공개할 데이터나 메서드를 프로퍼티로 추가한 객체를 반환
    return {
               increase(){
    		return ++num;
			},
              decrease(){
                  return --num;
              }
    };
}());

Counter.num //undefined
Counter.increase() //1
Counter.decrease() //0

// 즉시 실행 함수는 객체를 반환
// 이 객체는 외부에 노출하고 싶은 변수나 함수를 반환
// 반환되는 객체의 프로퍼티는 외부에 노출되는 퍼블릭 멤버
// 외부로 노출하고 싶지 않은 변수나 함수는 프라이빗 멤버
```



#### ES6 모듈

ES6 모듈은 파일 자체의 독자적인 모듈 스코프를 제공

-> 모듈 내에서 var 키워드로 선언한 변수는 전역 변수가 아니며 window 객체의 프로퍼티도 아니다

```js
<script type="module" src="lib.mjs"></script>
<script type="module" src="app.mjs"></script>
// script 태그에 type="module" 어트리뷰트를 추가하면 로드된 자바스크립트 파일은 모듈로서 동작
```



